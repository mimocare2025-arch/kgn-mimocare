<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KGN Mimo Care</title>
  <meta name="description" content="KGN Mimo Care — দ্রুত, সঠিক ও সাশ্রয়ী মোবাইল সার্ভিস. Online booking, gallery, items, QR & simple pay." />
  <meta name="theme-color" content="#0b67ff">

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f7fb;color:#102033;line-height:1.5;padding-bottom:40px}
    .container{max-width:1100px;margin:0 auto;padding:14px}
    header{background:#fff;border-bottom:1px solid #e6eef9;position:sticky;top:0;z-index:999}
    .wrap{display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
    .brand{font-weight:800;font-size:20px;color:#0b67ff}
    nav ul{display:flex;gap:12px;list-style:none}
    nav a{text-decoration:none;color:#102033;padding:8px;border-radius:6px;font-weight:600}
    nav a:hover{background:rgba(11,103,255,0.06)}
    .menu-btn{display:none}
    @media(max-width:820px){
      nav ul{display:none;position:absolute;right:16px;top:64px;background:#fff;padding:10px;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,0.12)}
      nav.open ul{display:flex;flex-direction:column}
      .menu-btn{display:block}
    }
    .hero{background:linear-gradient(rgba(0,128,255,0.62), rgba(0,200,150,0.62)), url('mobile-bg.jpg') center/cover no-repeat;color:#fff;text-align:center;padding:70px 16px;border-bottom:6px solid #eef7ff}
    .hero h1{font-size:28px;margin-bottom:8px}
    .hero p{max-width:820px;margin:0 auto 10px;color:rgba(255,255,255,0.95)}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700}
    .btn-primary{background:#0527ff;color:#fff}
    .btn-ghost{background:rgba(255,255,255,0.12);color:#fff;border:1px solid rgba(255,255,255,0.18)}
    section{padding:20px 0}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 8px 30px rgba(12,36,75,0.04);margin-bottom:12px}
    h2{font-size:18px;margin-bottom:8px}
    .muted{color:#52606d;font-size:14px}
    .items-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .item-card{background:#fff;border:1px solid #eef6ff;padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:10px}
    .item-img{width:100%;height:150px;background:#eef6ff;border-radius:8px;object-fit:cover}
    .item-title{font-weight:800}
    .item-price{color:#0b67ff;font-weight:800}
    .layout{display:grid;grid-template-columns:1fr 380px;gap:12px;align-items:start}
    @media(max-width:980px){.layout{grid-template-columns:1fr}}
    .cart-box{position:sticky;top:86px}
    .cart-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:#fbfcff;border:1px solid #eef6ff;margin-bottom:8px}
    .tabs{display:flex;gap:8px;margin-bottom:8px}
    .tab{padding:8px 12px;border-radius:8px;background:#eef6ff;color:#024;cursor:pointer}
    .tab.active{background:#0b67ff;color:#fff}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    .thumb{background:#fff;border-radius:8px;padding:8px;border:1px solid #e8f0ff;display:flex;flex-direction:column;gap:8px}
    .thumb img{width:100%;height:120px;object-fit:cover;border-radius:6px;background:#f3f6ff}
    .small{font-size:13px;color:#556}
    textarea,input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #dde6f3}
    .admin-bar{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .note{font-size:13px;color:#445;margin-top:8px}
    footer{margin-top:20px;padding:16px;text-align:center;color:#6b7b8a}
    /* small helpers */
    .hidden{display:none}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">KGN Mimo Care</div>
      <nav id="mainNav">
        <button class="menu-btn" id="menuBtn" aria-expanded="false">☰</button>
        <ul>
          <li><a class="navlink" href="#home">Home</a></li>
          <li><a class="navlink" href="#services">Services</a></li>
          <li><a class="navlink" href="#items">Items</a></li>
          <li><a class="navlink" href="#gallery">Gallery</a></li>
          <li><a class="navlink" href="#booking">Booking</a></li>
          <li><a class="navlink" href="#contact">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section id="home" class="hero" role="region" aria-label="Hero">
    <div class="container">
      <h1>KGN Mimo Care — দ্রুত, সঠিক ও সাশ্রয়ী মোবাইল সার্ভিস</h1>
      <p>২০ বছরের অভিজ্ঞতা • ২০ জন দক্ষ টেকনিশিয়ান • চিপ-লেভেল সার্ভিস • দ্রুত হোম ডেলিভারি</p>
      <div style="margin-top:12px">
        <a class="btn btn-primary" href="#items">আইটেমস দেখুন</a>
        <a class="btn btn-ghost" href="#gallery">গ্যালারি</a>
      </div>
    </div>
  </section>

  <div class="container">
    <section id="services">
      <div class="card">
        <h2>আমাদের বিশেষত্ব</h2>
        <ul style="margin-top:8px;line-height:1.6">
          <li><strong>২০ বছরের অভিজ্ঞতা</strong></li>
          <li><strong>২০ জন টেকনিশিয়ান</strong></li>
          <li><strong>চিপ-লেভেল (IC) সার্ভিস</strong></li>
          <li><strong>খুব কম রেটে কাজ</strong></li>
          <li><strong>৯৯% সফলতা</strong></li>
        </ul>
      </div>
    </section>

    <section id="items">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><h2>আমাদের আইটেম/সার্ভিস লিস্ট</h2><div class="small">আইটেম-এ অড টু কার্ট করে বুকিং ফর্মে পাঠানো যাবে</div></div>
          <div class="small">বুকিং ফি: ₹49 (শেষ বিল থেকে adjust)</div>
        </div>

        <div class="layout" style="margin-top:12px">
          <div>
            <div id="itemsGrid" class="items-grid"></div>

            <div style="margin-top:12px" class="card">
              <div class="admin-bar">
                <div class="small">Owner admin (Password required)</div>
                <div><button id="adminOpen" class="btn">Admin</button></div>
              </div>
              <div id="adminArea" style="display:none;margin-top:10px">
                <label>Item name</label><input id="adminName" type="text" placeholder="Display - Samsung A03">
                <label style="margin-top:8px">Price (₹)</label><input id="adminPrice" type="number" placeholder="1999">
                <label style="margin-top:8px">Image (optional)</label><input id="adminImage" type="file" accept="image/*">
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button id="addItemBtn" class="btn">Add Item</button>
                  <button id="resetItems" class="btn btn-ghost">Reset to default</button>
                </div>

                <div style="margin-top:10px">
                  <button id="viewOrdersBtn" class="btn btn-ghost">View Orders</button>
                </div>

                <div class="note">নোট: Admin local-only। আপডেটগুলো ব্রাউজারের localStorage-এ থাকবে। পরে সার্ভারে রাখতে চাইলে বলবে আমি সেটাপ করব।</div>
              </div>
            </div>
          </div>

          <aside class="cart-box">
            <div class="card">
              <h3>Cart Summary</h3>
              <div id="cartList" style="margin-top:8px"><div class="small">Cart is empty</div></div>

              <div style="margin-top:10px">
                <div style="display:flex;justify-content:space-between"><div class="small">Subtotal</div><div id="subtotal">₹0</div></div>
                <div style="display:flex;justify-content:space-between;margin-top:6px"><div class="small">Booking fee</div><div>₹49</div></div>

                <div style="margin-top:8px">
                  <label class="small">ছাড়</label>
                  <select id="discountType" style="width:100%;padding:8px;border-radius:8px;border:1px solid #dde6f3;margin-top:6px">
                    <option value="0">কোনো ছাড় নেই</option>
                    <option value="10">ওয়েব বুকিং — 10%</option>
                    <option value="20">অগ্রিম পেমেন্ট — 20%</option>
                    <option value="50">ডিলার / স্পেশাল — 50%</option>
                  </select>
                </div>

                <div style="display:flex;justify-content:space-between;margin-top:10px;font-weight:800">
                  <div>Total</div><div id="totalAmount">₹0</div>
                </div>

                <div style="display:flex;gap:8px;margin-top:12px">
                  <button id="proceedBtn" class="btn">Proceed</button>
                  <button id="clearCartBtn" class="btn btn-ghost">Clear</button>
                </div>
                <div class="note">Booking fee ₹49 পরে adjust হবে। Payment: WhatsApp/UPI/PayPal placeholder (demo).</div>
              </div>
            </div>
          </aside>
        </div>

      </div>
    </section>

    <section id="gallery" style="margin-top:12px">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><h2>Gallery — Technicians ও Shop</h2><div class="small">Owner/Technician ফোন থেকে ছবি তুলে আপলোড করো (local only)</div></div>
          <div>
            <button id="uploadBtn" class="btn">Upload / Take Photo</button>
            <input id="uploadInput" type="file" accept="image/*" capture="environment" style="display:none">
          </div>
        </div>

        <div style="margin-top:10px" class="tabs">
          <div class="tab active" data-cat="technicians">Technicians</div>
          <div class="tab" data-cat="shop">Shop</div>
        </div>

        <div id="galleryGrid" class="grid" style="margin-top:12px"></div>

        <div style="margin-top:10px" class="note">প্রতি ছবি ওপেন করলে note যোগ করা যাবে, QR জেনারেট করা যাবে। Scan QR to open same image (QR scanner নিচে আছে)।</div>
      </div>

      <div id="modal" class="hidden" style="position:fixed;inset:0;background:rgba(2,6,23,0.6);align-items:center;justify-content:center;padding:18px;">
        <div style="max-width:900px;width:100%;background:#fff;padding:14px;border-radius:10px;position:relative">
          <button id="closeModal" style="position:absolute;right:12px;top:12px;background:#ef4444;color:#fff;border:0;padding:6px 8px;border-radius:6px;cursor:pointer">Close</button>
          <div style="display:grid;grid-template-columns:1fr 320px;gap:12px">
            <div>
              <img id="modalImg" src="" alt="" style="width:100%;height:360px;object-fit:contain;border-radius:8px;background:#f3f6ff" />
              <div style="margin-top:8px">
                <strong id="modalTitle"></strong><div id="modalMeta" class="small muted"></div>
              </div>
              <div style="margin-top:8px">
                <label>Comment / Note</label>
                <textarea id="modalComment" rows="4" placeholder="কমেন্ট লিখুন..."></textarea>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button id="saveComment" class="btn">Save Note</button>
                  <button id="downloadImg" class="btn btn-ghost">Download</button>
                </div>
              </div>
            </div>

            <aside>
              <div style="text-align:center">
                <div style="margin-bottom:8px"><strong>QR for this image</strong></div>
                <img id="qrPreview" src="" alt="QR" style="width:220px;height:220px;border:1px solid #eef6f7;border-radius:8px">
                <div style="margin-top:8px"><a id="downloadQR" class="btn btn-ghost" style="text-decoration:none">Download QR</a></div>
              </div>

              <div style="margin-top:12px">
                <div class="small">Actions:</div>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button id="copyLink" class="btn btn-ghost">Copy Link</button>
                  <button id="shareBtn" class="btn">Share (Phone)</button>
                </div>

                <div class="note" style="margin-top:12px">
                  নিচে QR-স্ক্যানার দেয়া আছে — স্ক্যান করে একই পেজে ছবি খুলে note যোগ করতে পারবে।
                </div>

                <div style="margin-top:12px">
                  <strong>QR Scanner</strong>
                  <div id="qr-reader" style="width:300px;margin-top:8px"></div>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </div>

    </section>

    <section id="booking" style="margin-top:12px">
      <div class="card">
        <h2>Order / Booking Form</h2>
        <p class="small">Cart-এ থেকে Proceed করলে এখানে Order Summary ভরে যাবে — Submit করলে order localStorage-এ saved হবে এবং admin দেখতে পারবে।</p>

        <form id="orderForm" name="order-form">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px">
            <div><label>নাম</label><input id="custName" name="name" type="text" required></div>
            <div><label>মোবাইল নম্বর</label><input id="custPhone" name="phone" type="tel" placeholder="7001181931" required></div>
          </div>

          <div style="margin-top:8px">
            <label>ঠিকানা (যদি ডেলিভারি)</label>
            <textarea id="custAddress" name="address" rows="2"></textarea>
          </div>

          <div style="margin-top:8px">
            <label>Order summary</label>
            <textarea id="orderSummary" name="order_summary" rows="4" readonly placeholder="Cart থেকে ডেটা এখানে আসবে"></textarea>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button type="submit" class="btn">Submit Order (Save)</button>
            <button type="button" id="payViaWhatsApp" class="btn btn-ghost">Pay via WhatsApp / UPI</button>
            <button type="button" id="payDemo" class="btn btn-ghost">Pay Demo (Mark Paid)</button>
          </div>

          <div class="note" style="margin-top:8px">Demo mode: এখানে পেমেন্ট সম্পন্ন হলে তুমি পরে Netlify/Server এ সংযুক্ত করতে পারবে — আমি পরে সেটাও করে দেবো।</div>
        </form>
      </div>
    </section>

    <section id="contact" style="margin-top:12px">
      <div class="card">
        <h2>যোগাযোগ</h2>
        <p><strong>Branches:</strong><br>PNB ব্যাংকের পাশে, বিল্ডিং-এর ২য় তলা<br>নতুন রোড, অটো স্ট্যান্ডের পাশে</p>

        <p style="margin-top:10px"><strong>ফোন:</strong>
          <a href="tel:+917001181931">7001181931</a>,
          <a href="tel:+919382758151">9382758151</a>,
          <a href="tel:+919153644541">9153644541</a>
        </p>

        <div style="display:flex;gap:8px;margin-top:8px">
          <a class="btn" href="tel:+917001181931" style="background:#10b981;color:#fff;border-radius:8px;padding:10px 12px;text-decoration:none">📞 Call</a>
          <a class="btn" href="https://wa.me/917001181931" target="_blank" rel="noopener" style="background:#25D366;color:#fff;border-radius:8px;padding:10px 12px;text-decoration:none">💬 WhatsApp</a>
        </div>

        <p class="small" style="margin-top:10px">Email: <a href="mailto:mimocare2025@gmail.com">mimocare2025@gmail.com</a> | Website email: <a href="mailto:info@kgnmimocare.com">info@kgnmimocare.com</a></p>

        <p class="small" style="margin-top:8px"><strong>Timing:</strong> প্রতিদিন সকাল ৯টা – রাত ৯টা</p>
      </div>
    </section>

    <footer>
      <div class="small" style="text-align:center;margin-top:8px">© 2025 KGN Mimo Care — ২০ বছরের অভিজ্ঞতা • ২০ জন টেকনিশিয়ান</div>
    </footer>
  </div>

  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

  <script>
    /* ========== Config & storage keys ========== */
    const ADMIN_PASS = 'kgnadmin123'; // change later if you want
    const STORAGE_ITEMS = 'kgn_items_v2';
    const STORAGE_CART = 'kgn_cart_v2';
    const STORAGE_GALLERY = 'kgn_gallery_v2';
    const STORAGE_ORDERS = 'kgn_orders_v1';

    const defaultItems = [
      { id:'i1', name:'Display - Samsung A03', price:1999, img:'' },
      { id:'i2', name:'Battery - Generic 3000mAh', price:499, img:'' },
      { id:'i3', name:'Charging IC Repair', price:899, img:'' }
    ];

    let items = JSON.parse(localStorage.getItem(STORAGE_ITEMS) || 'null') || defaultItems.slice();
    let cart = JSON.parse(localStorage.getItem(STORAGE_CART) || '[]');
    let gallery = JSON.parse(localStorage.getItem(STORAGE_GALLERY) || 'null') || { technicians:[], shop:[] };
    let orders = JSON.parse(localStorage.getItem(STORAGE_ORDERS) || '[]');
    let currentGalleryCat = 'technicians';

    function uid(){ return 'id'+Date.now()+Math.floor(Math.random()*90); }
    function formatINR(n){ return '₹' + Number(n).toLocaleString('en-IN'); }
    function saveAll(){ localStorage.setItem(STORAGE_ITEMS, JSON.stringify(items)); localStorage.setItem(STORAGE_CART, JSON.stringify(cart)); localStorage.setItem(STORAGE_GALLERY, JSON.stringify(gallery)); localStorage.setItem(STORAGE_ORDERS, JSON.stringify(orders)); }

    /* ========== Render items ========== */
    function renderItems(){
      const grid = document.getElementById('itemsGrid');
      grid.innerHTML = '';
      items.forEach(it=>{
        const div = document.createElement('div'); div.className='item-card';
        div.innerHTML = `
          <img class="item-img" src="${it.img || 'data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=400 height=200><rect width=100% height=100% fill=%23eef6ff/></svg>'}" alt="${it.name}">
          <div class="item-title">${it.name}</div>
          <div class="item-price">${formatINR(it.price)}</div>
          <div style="margin-top:auto"><button class="btn add-to-cart" data-id="${it.id}">Add to cart</button></div>
        `;
        grid.appendChild(div);
      });
      document.querySelectorAll('.add-to-cart').forEach(b=>b.addEventListener('click', (e)=>{
        const id = e.target.getAttribute('data-id');
        addToCart(id);
      }));
    }

    /* ========== Cart ========== */
    function addToCart(id){
      const it = items.find(x=>x.id===id);
      if(!it) return;
      cart.push({...it});
      localStorage.setItem(STORAGE_CART, JSON.stringify(cart));
      renderCart();
      alert(it.name + ' added to cart');
    }
    function clearCart(){ cart = []; saveAll(); renderCart(); }
    function renderCart(){
      const list = document.getElementById('cartList');
      list.innerHTML = '';
      if(cart.length===0){ list.innerHTML='<div class="small">Cart is empty</div>'; document.getElementById('subtotal').textContent='₹0'; document.getElementById('totalAmount').textContent='₹0'; return; }
      cart.forEach((c,idx)=>{
        const div = document.createElement('div'); div.className='cart-item';
        div.innerHTML = <div>${c.name}</div><div>${formatINR(c.price)} <button data-idx="${idx}" style="margin-left:8px;background:transparent;border:0;cursor:pointer">✖</button></div>;
        list.appendChild(div);
      });
      document.querySelectorAll('[data-idx]').forEach(btn=>btn.addEventListener('click',(e)=>{
        const i = Number(e.target.getAttribute('data-idx'));
        cart.splice(i,1); saveAll(); renderCart();
      }));
      const sub = cart.reduce((s,x)=>s+Number(x.price),0);
      document.getElementById('subtotal').textContent = formatINR(sub);
      updateTotal();
    }
    function updateTotal(){
      const sub = cart.reduce((s,x)=>s+Number(x.price),0);
      const fee = 49;
      const discPerc = Number(document.getElementById('discountType').value || 0);
      const discount = Math.round((sub * discPerc)/100);
      const total = Math.max(0, sub + fee - discount);
      document.getElementById('totalAmount').textContent = formatINR(total);
    }

    /* ========== Admin ========== */
    document.getElementById('adminOpen').addEventListener('click', ()=>{
      const p = prompt('Enter admin password:');
      if(p === ADMIN_PASS){
        document.getElementById('adminArea').style.display = 'block';
      } else { alert('Wrong password'); }
    });

    document.getElementById('addItemBtn').addEventListener('click', async ()=>{
      const name = document.getElementById('adminName').value.trim();
      const price = Number(document.getElementById('adminPrice').value);
      const file = document.getElementById('adminImage').files[0];
      if(!name || !price){ alert('Name and price required'); return; }
      let imgData = '';
      if(file){
        imgData = await readFileAsDataURL(file);
      }
      const id = uid();
      items.unshift({id,name,price,img:imgData});
      saveAll(); renderItems(); document.getElementById('adminName').value=''; document.getElementById('adminPrice').value=''; document.getElementById('adminImage').value='';
      alert('Item added locally');
    });

    document.getElementById('resetItems').addEventListener('click', ()=>{ if(confirm('Reset items to default?')){ items = defaultItems.slice(); saveAll(); renderItems(); } });

    document.getElementById('viewOrdersBtn').addEventListener('click', ()=>{
      const existing = JSON.parse(localStorage.getItem(STORAGE_ORDERS) || '[]');
      if(!existing.length){ alert('No orders yet'); return; }
      let html = '<h2>Orders</h2><div style="font-family:Arial,Helvetica,sans-serif">';
      existing.forEach(o=>{
        html += <div style="border:1px solid #eee;padding:8px;margin:8px 0;border-radius:6px"><strong>ID:</strong> ${o.id}<br><strong>Name:</strong> ${o.name} — <strong>Phone:</strong> ${o.phone}<br><strong>Total:</strong> ${o.total}<br><strong>Items:</strong><ul>;
        o.items.forEach(it=> html += <li>${it.name} — ₹${it.price}</li>);
        html += </ul><strong>Address:</strong> ${o.address || '-'}<br><em>Created: ${new Date(o.created).toLocaleString()}</em></div>;
      });
      html += '</div>';
      const w = window.open('', '_blank', 'width=700,height=700,scrollbars=1');
      w.document.write('<title>Orders</title>');
      w.document.write(html);
    });

    /* ========== File helpers ========== */
    function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }

    /* ========== Gallery upload/render/modal/QR ========== */
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(t=> t.addEventListener('click', ()=> {
      tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active');
      currentGalleryCat = t.dataset.cat;
      renderGallery();
    }));

    document.getElementById('uploadBtn').addEventListener('click', ()=> document.getElementById('uploadInput').click());
    document.getElementById('uploadInput').addEventListener('change', async (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      const name = prompt('Name for this photo (optional):', f.name) || f.name;
      try{
        const data = await readFileAsDataURL(f);
        gallery[currentGalleryCat].unshift({ id: uid(), name, data, note:'', created: new Date().toISOString() });
        saveAll(); renderGallery();
        e.target.value='';
        alert('Image uploaded locally');
      }catch(err){
        console.error('Upload/read error', err);
        alert('Image upload failed: ' + err.message);
      }
    });

    function renderGallery(){
      const grid = document.getElementById('galleryGrid');
      grid.innerHTML = '';
      const list = gallery[currentGalleryCat] || [];
      if(list.length === 0){ grid.innerHTML = '<div class="card">No images yet — Upload using Upload / Take Photo</div>'; return; }
      list.forEach((it, idx)=>{
        const div = document.createElement('div'); div.className='thumb';
        div.innerHTML = <img src="${it.data}" alt="${it.name}"><div style="font-weight:700">${it.name}</div><div class="small">${it.note ? it.note.substring(0,60) : ''}</div><div style="display:flex;gap:6px"><button class="btn open-img" data-idx="${idx}">Open</button><button class="btn btn-ghost rem-img" data-idx="${idx}">Remove</button></div>;
        grid.appendChild(div);
      });
      document.querySelectorAll('.open-img').forEach(b=> b.addEventListener('click', (e)=> openModal(Number(e.target.getAttribute('data-idx')))));
      document.querySelectorAll('.rem-img').forEach(b=> b.addEventListener('click', (e)=> {
        const i = Number(e.target.getAttribute('data-idx'));
        if(confirm('Remove image?')){ gallery[currentGalleryCat].splice(i,1); saveAll(); renderGallery(); }
      }));
    }

    let currentModalIndex = null;
    function openModal(idx){
      currentModalIndex = idx;
      const item = gallery[currentGalleryCat][idx];
      document.getElementById('modalImg').src = item.data;
      document.getElementById('modalTitle').textContent = item.name || 'Image';
      document.getElementById('modalMeta').textContent = 'Uploaded: ' + new Date(item.created).toLocaleString();
      document.getElementById('modalComment').value = item.note || '';
      const link = window.location.origin + window.location.pathname + '#img=' + encodeURIComponent(item.id) + '&cat=' + encodeURIComponent(currentGalleryCat);
      const qr = 'https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=' + encodeURIComponent(link);
      document.getElementById('qrPreview').src = qr;
      document.getElementById('downloadQR').href = qr;
      document.getElementById('downloadQR').download = (item.name||'img') + '_qr.png';
      document.getElementById('copyLink').onclick = async ()=> { try{ await navigator.clipboard.writeText(link); alert('Link copied'); } catch(e){ prompt('Copy link:', link); } };
      document.getElementById('shareBtn').onclick = async ()=> { if(navigator.share){ try{ await navigator.share({title:item.name,text:'KGN Mimo Care image',url:link}); }catch(e){ alert('Share cancelled'); } } else alert('Share not supported'); };
      document.getElementById('downloadImg').onclick = ()=> { const a=document.createElement('a'); a.href=item.data; a.download=(item.name||'img')+'.png'; a.click(); };
      document.getElementById('modal').classList.remove('hidden');
    }
    document.getElementById('closeModal').addEventListener('click', ()=> { document.getElementById('modal').classList.add('hidden'); currentModalIndex=null; if(window.qrScanner){ qrScanner.stop().catch(()=>{}); qrScanner = null; } });

    document.getElementById('saveComment').addEventListener('click', ()=>{
      if(currentModalIndex===null) return;
      const txt = document.getElementById('modalComment').value.trim();
      gallery[currentGalleryCat][currentModalIndex].note = txt;
      saveAll(); renderGallery();
      alert('Note saved');
    });

    function checkHashOpen(){
      const h = location.hash;
      if(!h) return;
      const m = h.match(/img=([^&]+).*cat=([^&]+)/);
      if(!m) return;
      const id = decodeURIComponent(m[1]); const cat = decodeURIComponent(m[2]);
      const list = gallery[cat] || [];
      const idx = list.findIndex(x=>x.id===id);
      if(idx>=0){
        document.querySelectorAll('.tab').forEach(t=> t.classList.toggle('active', t.dataset.cat===cat));
        currentGalleryCat = cat;
        renderGallery();
        openModal(idx);
      }
    }
    window.addEventListener('hashchange', checkHashOpen);
    setTimeout(checkHashOpen,500);

    /* ========== QR Scanner (html5-qrcode) ========== */
    let qrScanner = null;
    function startQrScanner(){
      if(qrScanner) return;
      const el = document.getElementById('qr-reader');
      el.innerHTML = '';
      qrScanner = new Html5Qrcode("qr-reader");
      qrScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
        (decoded)=>{
          window.location.href = decoded;
          qrScanner.stop().catch(()=>{}); qrScanner = null;
        },
        (err)=>{}
      ).catch(err=> { console.error('QR start error', err); alert('Scanner start failed: ' + err.message); });
    }
    document.getElementById('qrPreview').addEventListener('click', ()=> {
      if(confirm('Scanner open করে QR scan করতে চান?')) startQrScanner();
    });

    /* ========== Order form (save to localStorage) ========== */
    document.getElementById('orderForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = document.getElementById('custName').value.trim();
      const phone = document.getElementById('custPhone').value.trim();
      if(!name || !phone){ alert('নাম ও ফোন দেন'); return; }
      const payload = {
        id: 'ord' + Date.now(),
        name,
        phone,
        address: document.getElementById('custAddress').value.trim(),
        items: cart,
        subtotal: cart.reduce((s,x)=>s+Number(x.price),0),
        bookingFee:49,
        discount: document.getElementById('discountType').value,
        total: document.getElementById('totalAmount').textContent,
        created: new Date().toISOString()
      };

      orders.unshift(payload);
      localStorage.setItem(STORAGE_ORDERS, JSON.stringify(orders));

      console.log('Order saved (local):', payload);
      alert('Order saved locally. Admin -> View Orders থেকে দেখুন।');

      document.getElementById('orderForm').reset();
      cart = []; saveAll(); renderCart();
      document.getElementById('orderSummary').value = '';
    });

    document.getElementById('payViaWhatsApp').addEventListener('click', ()=>{
      if(cart.length===0){ alert('Cart empty'); return; }
      const itemsText = cart.map(it=> ${it.name} - ₹${it.price}).join('%0A');
      const total = document.getElementById('totalAmount').textContent;
      const msg = encodeURIComponent(KGN Mimo Care - Order request\n${itemsText}\nTotal: ${total}\nPlease confirm payment.);
      window.open('https://wa.me/917001181931?text=' + msg, '_blank');
    });

    document.getElementById('payDemo').addEventListener('click', ()=>{
      if(cart.length===0){ alert('Cart empty'); return; }
      if(confirm('Demo: Mark order as Paid? (This is local demo)')){
        alert('Marked paid (demo).');
      }
    });

    /* ========== init & helpers ========== */
    function renderAll(){ renderItems(); renderCart(); renderGallery(); }
    document.getElementById('proceedBtn').addEventListener('click', ()=> {
      document.getElementById('orderSummary').value = cart.map(it=>${it.name} — ₹${it.price}).join('\\n');
      document.getElementById('orderForm').scrollIntoView({behavior:'smooth'});
    });
    document.getElementById('clearCartBtn').addEventListener('click', ()=>{ if(confirm('Clear cart?')){ clearCart(); }});
    document.getElementById('discountType').addEventListener('change', updateTotal);

    // init
    renderAll();

    // nav toggle
    const menuBtn = document.getElementById('menuBtn'), mainNav = document.getElementById('mainNav');
    if(menuBtn){ menuBtn.addEventListener('click', ()=> mainNav.classList.toggle('open')); }
  </script>
</body>
</html>
